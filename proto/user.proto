syntax = "proto3";

package user;

import "google/api/annotations.proto";

service UserService {
  // --- Public (no auth) ---
  // Sign up new user (name, email, password)
  rpc SignUp (SignUpRequest) returns (SignUpResponse) {
    option (google.api.http) = {
      post: "/v1/user/sign-up"
      body: "*"
    };
  }

  rpc ConfirmEmail (ConfirmEmailRequest) returns (ConfirmEmailResponse) {
    option (google.api.http) = {
      post: "/v1/user/confirm-email"
      body: "*"
    };
  }

  rpc SendVerificationEmail (SendVerificationEmailRequest) returns (SendVerificationEmailResponse) {
    option (google.api.http) = {
      post: "/v1/user/send-verification-email"
      body: "*"
    };
  }

  rpc Login (LoginRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/v1/user/login"
      body: "*"
    };
  }

  rpc CreateApiKey (CreateApiKeyRequest) returns (ApiKeyInfo) {
    option (google.api.http) = {
      post: "/v1/user/api-keys"
      body: "*"
    };
  }

  rpc GetApiKey (GetApiKeyRequest) returns (ApiKeyInfo) {
    option (google.api.http) = {
      get: "/v1/user/api-key"
      additional_bindings {
        get: "/v1/user/api-key/{user_email}"
      }
    };
  }

  rpc GetMe (GetMeRequest) returns (GetMeResponse) {
    option (google.api.http) = {
      get: "/v1/user/me"
      additional_bindings {
        get: "/v1/user/me/{email}"
      }
    };
  }
}

// Sign-up
message SignUpRequest { string name = 1; string email = 2; string password = 3; }
message SignUpResponse { string user_id = 1; }

message SendVerificationEmailRequest {
  string email = 1;
}

message SendVerificationEmailResponse {
  bool success = 1;
  string message = 2;
}

// Confirm
message ConfirmEmailRequest { string email = 1; string code = 2; }
message ConfirmEmailResponse { bool success = 1; }

// Auth
message LoginRequest { string email = 1; string password = 2; }
message LoginResponse {
  string user_id = 1;
  string name = 2;
  string email = 3;
}

message CreateApiKeyRequest { string user_email = 1; string created_at = 2; }

message GetApiKeyRequest { string user_email = 1;}
message ApiKeyInfo {
  string user_email = 1;
  string value = 2;
  string created_at = 3;
}

message GetApiKeyResponse { ApiKeyInfo key = 1; }

// Self
message GetMeRequest { string email = 1; }
message GetMeResponse {
  string user_id = 1;
  string name = 2;
  string email = 3;
  bool email_verified = 4;
}
